{"ast":null,"code":"import _toConsumableArray from \"/Users/devsoni/Desktop/Instrument-Visualizer-Project/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport { MOST_NEGATIVE_SINGLE_FLOAT, MOST_POSITIVE_SINGLE_FLOAT } from '../constants';\nexport var createAudioListenerFactory = function createAudioListenerFactory(createAudioParam, createNativeChannelMergerNode, createNativeConstantSourceNode, createNativeScriptProcessorNode, createNotSupportedError, getFirstSample, isNativeOfflineAudioContext, overwriteAccessors) {\n  return function (context, nativeContext) {\n    var nativeListener = nativeContext.listener; // Bug #117: Only Chrome, Edge & Opera support the new interface already.\n\n    var createFakeAudioParams = function createFakeAudioParams() {\n      var buffer = new Float32Array(1);\n      var channelMergerNode = createNativeChannelMergerNode(nativeContext, {\n        channelCount: 1,\n        channelCountMode: 'explicit',\n        channelInterpretation: 'speakers',\n        numberOfInputs: 9\n      });\n      var isOffline = isNativeOfflineAudioContext(nativeContext);\n      var isScriptProcessorNodeCreated = false;\n      var lastOrientation = [0, 0, -1, 0, 1, 0];\n      var lastPosition = [0, 0, 0];\n\n      var createScriptProcessorNode = function createScriptProcessorNode() {\n        if (isScriptProcessorNodeCreated) {\n          return;\n        }\n\n        isScriptProcessorNodeCreated = true;\n        var scriptProcessorNode = createNativeScriptProcessorNode(nativeContext, 256, 9, 0); // tslint:disable-next-line:deprecation\n\n        scriptProcessorNode.onaudioprocess = function (_ref) {\n          var inputBuffer = _ref.inputBuffer;\n          var orientation = [getFirstSample(inputBuffer, buffer, 0), getFirstSample(inputBuffer, buffer, 1), getFirstSample(inputBuffer, buffer, 2), getFirstSample(inputBuffer, buffer, 3), getFirstSample(inputBuffer, buffer, 4), getFirstSample(inputBuffer, buffer, 5)];\n\n          if (orientation.some(function (value, index) {\n            return value !== lastOrientation[index];\n          })) {\n            nativeListener.setOrientation.apply(nativeListener, orientation); // tslint:disable-line:deprecation\n\n            lastOrientation = orientation;\n          }\n\n          var positon = [getFirstSample(inputBuffer, buffer, 6), getFirstSample(inputBuffer, buffer, 7), getFirstSample(inputBuffer, buffer, 8)];\n\n          if (positon.some(function (value, index) {\n            return value !== lastPosition[index];\n          })) {\n            nativeListener.setPosition.apply(nativeListener, positon); // tslint:disable-line:deprecation\n\n            lastPosition = positon;\n          }\n        };\n\n        channelMergerNode.connect(scriptProcessorNode);\n      };\n\n      var createSetOrientation = function createSetOrientation(index) {\n        return function (value) {\n          if (value !== lastOrientation[index]) {\n            lastOrientation[index] = value;\n            nativeListener.setOrientation.apply(nativeListener, _toConsumableArray(lastOrientation)); // tslint:disable-line:deprecation\n          }\n        };\n      };\n\n      var createSetPosition = function createSetPosition(index) {\n        return function (value) {\n          if (value !== lastPosition[index]) {\n            lastPosition[index] = value;\n            nativeListener.setPosition.apply(nativeListener, _toConsumableArray(lastPosition)); // tslint:disable-line:deprecation\n          }\n        };\n      };\n\n      var createFakeAudioParam = function createFakeAudioParam(input, initialValue, setValue) {\n        var constantSourceNode = createNativeConstantSourceNode(nativeContext, {\n          channelCount: 1,\n          channelCountMode: 'explicit',\n          channelInterpretation: 'discrete',\n          offset: initialValue\n        });\n        constantSourceNode.connect(channelMergerNode, 0, input); // @todo This should be stopped when the context is closed.\n\n        constantSourceNode.start();\n        Object.defineProperty(constantSourceNode.offset, 'defaultValue', {\n          get: function get() {\n            return initialValue;\n          }\n        });\n        /*\n         * Bug #62 & #74: Safari does not support ConstantSourceNodes and does not export the correct values for maxValue and\n         * minValue for GainNodes.\n         */\n\n        var audioParam = createAudioParam({\n          context: context\n        }, isOffline, constantSourceNode.offset, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n        overwriteAccessors(audioParam, 'value', function (get) {\n          return function () {\n            return get.call(audioParam);\n          };\n        }, function (set) {\n          return function (value) {\n            try {\n              set.call(audioParam, value);\n            } catch (err) {\n              if (err.code !== 9) {\n                throw err;\n              }\n            }\n\n            createScriptProcessorNode();\n\n            if (isOffline) {\n              // Bug #117: Using setOrientation() and setPosition() doesn't work with an OfflineAudioContext.\n              setValue(value);\n            }\n          };\n        });\n\n        audioParam.cancelAndHoldAtTime = function (cancelAndHoldAtTime) {\n          if (isOffline) {\n            return function () {\n              throw createNotSupportedError();\n            };\n          }\n\n          return function () {\n            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n              args[_key] = arguments[_key];\n            }\n\n            var value = cancelAndHoldAtTime.apply(audioParam, args);\n            createScriptProcessorNode();\n            return value;\n          };\n        }(audioParam.cancelAndHoldAtTime);\n\n        audioParam.cancelScheduledValues = function (cancelScheduledValues) {\n          if (isOffline) {\n            return function () {\n              throw createNotSupportedError();\n            };\n          }\n\n          return function () {\n            for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n              args[_key2] = arguments[_key2];\n            }\n\n            var value = cancelScheduledValues.apply(audioParam, args);\n            createScriptProcessorNode();\n            return value;\n          };\n        }(audioParam.cancelScheduledValues);\n\n        audioParam.exponentialRampToValueAtTime = function (exponentialRampToValueAtTime) {\n          if (isOffline) {\n            return function () {\n              throw createNotSupportedError();\n            };\n          }\n\n          return function () {\n            for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n              args[_key3] = arguments[_key3];\n            }\n\n            var value = exponentialRampToValueAtTime.apply(audioParam, args);\n            createScriptProcessorNode();\n            return value;\n          };\n        }(audioParam.exponentialRampToValueAtTime);\n\n        audioParam.linearRampToValueAtTime = function (linearRampToValueAtTime) {\n          if (isOffline) {\n            return function () {\n              throw createNotSupportedError();\n            };\n          }\n\n          return function () {\n            for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n              args[_key4] = arguments[_key4];\n            }\n\n            var value = linearRampToValueAtTime.apply(audioParam, args);\n            createScriptProcessorNode();\n            return value;\n          };\n        }(audioParam.linearRampToValueAtTime);\n\n        audioParam.setTargetAtTime = function (setTargetAtTime) {\n          if (isOffline) {\n            return function () {\n              throw createNotSupportedError();\n            };\n          }\n\n          return function () {\n            for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n              args[_key5] = arguments[_key5];\n            }\n\n            var value = setTargetAtTime.apply(audioParam, args);\n            createScriptProcessorNode();\n            return value;\n          };\n        }(audioParam.setTargetAtTime);\n\n        audioParam.setValueAtTime = function (setValueAtTime) {\n          if (isOffline) {\n            return function () {\n              throw createNotSupportedError();\n            };\n          }\n\n          return function () {\n            for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n              args[_key6] = arguments[_key6];\n            }\n\n            var value = setValueAtTime.apply(audioParam, args);\n            createScriptProcessorNode();\n            return value;\n          };\n        }(audioParam.setValueAtTime);\n\n        audioParam.setValueCurveAtTime = function (setValueCurveAtTime) {\n          if (isOffline) {\n            return function () {\n              throw createNotSupportedError();\n            };\n          }\n\n          return function () {\n            for (var _len7 = arguments.length, args = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n              args[_key7] = arguments[_key7];\n            }\n\n            var value = setValueCurveAtTime.apply(audioParam, args);\n            createScriptProcessorNode();\n            return value;\n          };\n        }(audioParam.setValueCurveAtTime);\n\n        return audioParam;\n      };\n\n      return {\n        forwardX: createFakeAudioParam(0, 0, createSetOrientation(0)),\n        forwardY: createFakeAudioParam(1, 0, createSetOrientation(1)),\n        forwardZ: createFakeAudioParam(2, -1, createSetOrientation(2)),\n        positionX: createFakeAudioParam(6, 0, createSetPosition(0)),\n        positionY: createFakeAudioParam(7, 0, createSetPosition(1)),\n        positionZ: createFakeAudioParam(8, 0, createSetPosition(2)),\n        upX: createFakeAudioParam(3, 0, createSetOrientation(3)),\n        upY: createFakeAudioParam(4, 1, createSetOrientation(4)),\n        upZ: createFakeAudioParam(5, 0, createSetOrientation(5))\n      };\n    };\n\n    var _ref2 = nativeListener.forwardX === undefined ? createFakeAudioParams() : nativeListener,\n        forwardX = _ref2.forwardX,\n        forwardY = _ref2.forwardY,\n        forwardZ = _ref2.forwardZ,\n        positionX = _ref2.positionX,\n        positionY = _ref2.positionY,\n        positionZ = _ref2.positionZ,\n        upX = _ref2.upX,\n        upY = _ref2.upY,\n        upZ = _ref2.upZ;\n\n    return {\n      get forwardX() {\n        return forwardX;\n      },\n\n      get forwardY() {\n        return forwardY;\n      },\n\n      get forwardZ() {\n        return forwardZ;\n      },\n\n      get positionX() {\n        return positionX;\n      },\n\n      get positionY() {\n        return positionY;\n      },\n\n      get positionZ() {\n        return positionZ;\n      },\n\n      get upX() {\n        return upX;\n      },\n\n      get upY() {\n        return upY;\n      },\n\n      get upZ() {\n        return upZ;\n      }\n\n    };\n  };\n};","map":{"version":3,"sources":["../../../src/factories/audio-listener-factory.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { MOST_NEGATIVE_SINGLE_FLOAT, MOST_POSITIVE_SINGLE_FLOAT } from '../constants';\nexport const createAudioListenerFactory = (createAudioParam, createNativeChannelMergerNode, createNativeConstantSourceNode, createNativeScriptProcessorNode, createNotSupportedError, getFirstSample, isNativeOfflineAudioContext, overwriteAccessors) => {\n    return (context, nativeContext) => {\n        const nativeListener = nativeContext.listener;\n        // Bug #117: Only Chrome, Edge & Opera support the new interface already.\n        const createFakeAudioParams = () => {\n            const buffer = new Float32Array(1);\n            const channelMergerNode = createNativeChannelMergerNode(nativeContext, {\n                channelCount: 1,\n                channelCountMode: 'explicit',\n                channelInterpretation: 'speakers',\n                numberOfInputs: 9\n            });\n            const isOffline = isNativeOfflineAudioContext(nativeContext);\n            let isScriptProcessorNodeCreated = false;\n            let lastOrientation = [0, 0, -1, 0, 1, 0];\n            let lastPosition = [0, 0, 0];\n            const createScriptProcessorNode = () => {\n                if (isScriptProcessorNodeCreated) {\n                    return;\n                }\n                isScriptProcessorNodeCreated = true;\n                const scriptProcessorNode = createNativeScriptProcessorNode(nativeContext, 256, 9, 0);\n                // tslint:disable-next-line:deprecation\n                scriptProcessorNode.onaudioprocess = ({ inputBuffer }) => {\n                    const orientation = [\n                        getFirstSample(inputBuffer, buffer, 0),\n                        getFirstSample(inputBuffer, buffer, 1),\n                        getFirstSample(inputBuffer, buffer, 2),\n                        getFirstSample(inputBuffer, buffer, 3),\n                        getFirstSample(inputBuffer, buffer, 4),\n                        getFirstSample(inputBuffer, buffer, 5)\n                    ];\n                    if (orientation.some((value, index) => value !== lastOrientation[index])) {\n                        nativeListener.setOrientation(...orientation); // tslint:disable-line:deprecation\n                        lastOrientation = orientation;\n                    }\n                    const positon = [\n                        getFirstSample(inputBuffer, buffer, 6),\n                        getFirstSample(inputBuffer, buffer, 7),\n                        getFirstSample(inputBuffer, buffer, 8)\n                    ];\n                    if (positon.some((value, index) => value !== lastPosition[index])) {\n                        nativeListener.setPosition(...positon); // tslint:disable-line:deprecation\n                        lastPosition = positon;\n                    }\n                };\n                channelMergerNode.connect(scriptProcessorNode);\n            };\n            const createSetOrientation = (index) => (value) => {\n                if (value !== lastOrientation[index]) {\n                    lastOrientation[index] = value;\n                    nativeListener.setOrientation(...lastOrientation); // tslint:disable-line:deprecation\n                }\n            };\n            const createSetPosition = (index) => (value) => {\n                if (value !== lastPosition[index]) {\n                    lastPosition[index] = value;\n                    nativeListener.setPosition(...lastPosition); // tslint:disable-line:deprecation\n                }\n            };\n            const createFakeAudioParam = (input, initialValue, setValue) => {\n                const constantSourceNode = createNativeConstantSourceNode(nativeContext, {\n                    channelCount: 1,\n                    channelCountMode: 'explicit',\n                    channelInterpretation: 'discrete',\n                    offset: initialValue\n                });\n                constantSourceNode.connect(channelMergerNode, 0, input);\n                // @todo This should be stopped when the context is closed.\n                constantSourceNode.start();\n                Object.defineProperty(constantSourceNode.offset, 'defaultValue', {\n                    get() {\n                        return initialValue;\n                    }\n                });\n                /*\n                 * Bug #62 & #74: Safari does not support ConstantSourceNodes and does not export the correct values for maxValue and\n                 * minValue for GainNodes.\n                 */\n                const audioParam = createAudioParam({ context }, isOffline, constantSourceNode.offset, MOST_POSITIVE_SINGLE_FLOAT, MOST_NEGATIVE_SINGLE_FLOAT);\n                overwriteAccessors(audioParam, 'value', (get) => () => get.call(audioParam), (set) => (value) => {\n                    try {\n                        set.call(audioParam, value);\n                    }\n                    catch (err) {\n                        if (err.code !== 9) {\n                            throw err;\n                        }\n                    }\n                    createScriptProcessorNode();\n                    if (isOffline) {\n                        // Bug #117: Using setOrientation() and setPosition() doesn't work with an OfflineAudioContext.\n                        setValue(value);\n                    }\n                });\n                audioParam.cancelAndHoldAtTime = ((cancelAndHoldAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = cancelAndHoldAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.cancelAndHoldAtTime);\n                audioParam.cancelScheduledValues = ((cancelScheduledValues) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = cancelScheduledValues.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.cancelScheduledValues);\n                audioParam.exponentialRampToValueAtTime = ((exponentialRampToValueAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = exponentialRampToValueAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.exponentialRampToValueAtTime);\n                audioParam.linearRampToValueAtTime = ((linearRampToValueAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = linearRampToValueAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.linearRampToValueAtTime);\n                audioParam.setTargetAtTime = ((setTargetAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = setTargetAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.setTargetAtTime);\n                audioParam.setValueAtTime = ((setValueAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = setValueAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.setValueAtTime);\n                audioParam.setValueCurveAtTime = ((setValueCurveAtTime) => {\n                    if (isOffline) {\n                        return () => {\n                            throw createNotSupportedError();\n                        };\n                    }\n                    return (...args) => {\n                        const value = setValueCurveAtTime.apply(audioParam, args);\n                        createScriptProcessorNode();\n                        return value;\n                    };\n                })(audioParam.setValueCurveAtTime);\n                return audioParam;\n            };\n            return {\n                forwardX: createFakeAudioParam(0, 0, createSetOrientation(0)),\n                forwardY: createFakeAudioParam(1, 0, createSetOrientation(1)),\n                forwardZ: createFakeAudioParam(2, -1, createSetOrientation(2)),\n                positionX: createFakeAudioParam(6, 0, createSetPosition(0)),\n                positionY: createFakeAudioParam(7, 0, createSetPosition(1)),\n                positionZ: createFakeAudioParam(8, 0, createSetPosition(2)),\n                upX: createFakeAudioParam(3, 0, createSetOrientation(3)),\n                upY: createFakeAudioParam(4, 1, createSetOrientation(4)),\n                upZ: createFakeAudioParam(5, 0, createSetOrientation(5))\n            };\n        };\n        const { forwardX, forwardY, forwardZ, positionX, positionY, positionZ, upX, upY, upZ } = nativeListener.forwardX === undefined ? createFakeAudioParams() : nativeListener;\n        return {\n            get forwardX() {\n                return forwardX;\n            },\n            get forwardY() {\n                return forwardY;\n            },\n            get forwardZ() {\n                return forwardZ;\n            },\n            get positionX() {\n                return positionX;\n            },\n            get positionY() {\n                return positionY;\n            },\n            get positionZ() {\n                return positionZ;\n            },\n            get upX() {\n                return upX;\n            },\n            get upY() {\n                return upY;\n            },\n            get upZ() {\n                return upZ;\n            }\n        };\n    };\n};\n//# sourceMappingURL=audio-listener-factory.js.map"]},"metadata":{},"sourceType":"module"}